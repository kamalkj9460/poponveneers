{% assign main_discount_message = "" %}
{% assign main_discount_amount = 0 %}
{% assign main_discount_code = "" %}
{% assign variant_discount_ids = "" %}
{% assign variant_discount_messages = "" %}
{% assign variant_discount_amounts = "" %}
{% assign variant_discount_codes = "" %}
{% assign variant_discount_initial_amount = 0 %}
{% assign discounts_enabled = false %}

{% assign initial_discount_amount = 0 %}
{% assign product_note = "" %}

{% assign trust_icon_1 = "" %}
{% assign trust_icon_2 = "" %}
{% assign trust_icon_3 = "" %}
{% assign trust_icon_4 = "" %}
{% assign trust_icon_5 = "" %}
{% assign trust_icon_6 = "" %}
{% assign trust_icon_7 = "" %}

{% for tag in product.tags %}
  {% if tag contains 'Product Note:' %}
    {% assign product_note = tag | remove: "Product Note:" %}
  {% endif %}
  
  {% if tag contains 'Product Discount:' %}
    {% comment %}Product discount tag formatting: "Product Discount: DISCOUNT MESSAGE|DISCOUNT AMOUNT IN CENTS|DISCOUNT CODE"{% endcomment %}
    {% assign discount_data = tag | remove: "Product Discount:" | strip | split: '|' %}
    {% assign main_discount_message = discount_data[0] %}
    {% assign main_discount_amount = discount_data[1] | plus: 0 %}
    {% assign main_discount_code = discount_data[2] %}
    {% assign discounts_enabled = true %}
  {% endif %}
  
  {% if tag contains 'Variant Discount:' %}
    {% comment %}Variant discount tag formatting: "Variant Discount: VARIANT ID|DISCOUNT MESSAGE|DISCOUNT AMOUNT IN CENTS|DISCOUNT CODE"{% endcomment %}
    {% assign discount_data = tag | remove: "Variant Discount:" | strip | split: '|' %}
    {% if variant_discount_ids.size > 0 %}{% assign variant_discount_ids = variant_discount_ids | append: '|' %}{% endif %}
    {% assign variant_discount_ids = variant_discount_ids | append: discount_data[0] %}
    {% if variant_discount_messages.size > 0 %}{% assign variant_discount_messages = variant_discount_messages | append: '|' %}{% endif %}
    {% assign variant_discount_messages = variant_discount_messages | append: discount_data[1] %}
    {% if variant_discount_amounts.size > 0 %}{% assign variant_discount_amounts = variant_discount_amounts | append: '|' %}{% endif %}
    {% assign variant_discount_amounts = variant_discount_amounts | append: discount_data[2] %}
    {% if variant_discount_codes.size > 0 %}{% assign variant_discount_codes = variant_discount_codes | append: '|' %}{% endif %}
    {% assign variant_discount_codes = variant_discount_codes | append: discount_data[3] %}
    {% assign discounts_enabled = true %}
  {% endif %}

  <script>
    console.log('discounts enabled: ', {{ discounts_enabled | json }});
    console.log('main discount: ', {{ main_discount_amount | json }});
    console.log('variant discount: ', {{ variant_discount_amount | json }});
  </script>
  
  {% if tag contains 'Trust Icon 1' %}
    {% assign trust_icon_1 = tag | remove: 'Trust Icon 1: ' %}
  {% endif %}
  {% if tag contains 'Trust Icon 2' %}
    {% assign trust_icon_2 = tag | remove: 'Trust Icon 2: ' %}
  {% endif %}
  {% if tag contains 'Trust Icon 3' %}
    {% assign trust_icon_3 = tag | remove: 'Trust Icon 3: ' %}
  {% endif %}
  {% if tag contains 'Trust Icon 4' %}
    {% assign trust_icon_4 = tag | remove: 'Trust Icon 4: ' %}
  {% endif %}
  {% if tag contains 'Trust Icon 5' %}
    {% assign trust_icon_5 = tag | remove: 'Trust Icon 5: ' %}
  {% endif %}
  {% if tag contains 'Trust Icon 6' %}
    {% assign trust_icon_6 = tag | remove: 'Trust Icon 6: ' %}
  {% endif %}
  {% if tag contains 'Trust Icon 7' %}
    {% assign trust_icon_7 = tag | remove: 'Trust Icon 7: ' %}
  {% endif %}
{% endfor %}
{% assign variant_discount_ids = variant_discount_ids | split: '|' %}
{% assign variant_discount_messages = variant_discount_messages | split: '|' %}
{% assign variant_discount_amounts = variant_discount_amounts | split: '|' %}
{% assign variant_discount_codes = variant_discount_codes | split: '|' %}

{% comment %}Store discount tag override data in global JS variables for access in theme scripts, and store reference to initial variant discount amount if active.{% endcomment %}
<script>
  window.BONFIRE = window.BONFIRE || {};
  window.BONFIRE.tag_discounts_override = window.BONFIRE.tag_discounts_override || {};
  window.BONFIRE.tag_discounts_override.enabled = {% if main_discount_amount != blank or variant_discount_ids != blank %}true{% else %}false{% endif %};
  window.BONFIRE.tag_discounts_override.variant_discounts = {};
  {% for variant in product.variants %}
    {% assign found_variant_discount = false %}
    {% for discount_variant_id in variant_discount_ids %}
      {% assign discount_variant_id = discount_variant_id %}
      {% assign string_variant_id = variant.id | append: '' %}
      {% if string_variant_id == discount_variant_id %}
        {% assign variant_index = forloop.index0 %}
        {% assign variant_discount_message = variant_discount_messages[variant_index] %}
        {% assign variant_discount_amount = variant_discount_amounts[variant_index] %}
        {% assign variant_discount_code = variant_discount_codes[variant_index] %}
        {% if variant_discount_message != blank and variant_discount_amount != blank and variant_discount_code != blank %}
          {% assign found_variant_discount = true %}
          {% assign current_string_variant_id = product.selected_or_first_available_variant.id | append: '' %}
          window.BONFIRE.tag_discounts_override.variant_discounts[{{ variant.id }}] = {variant_id: {{ variant.id | json}}, message: {{ variant_discount_message | json}}, amount: {{ variant_discount_amount | json}}, code: {{ variant_discount_code | json}} };
  
          {% if discount_variant_id == current_string_variant_id %}
            {% assign variant_discount_initial_amount = variant_discount_amount | plus: 0 %}
          {% endif %}
        {% endif %}
        {% break %}
      {% endif %}
    {% endfor %}

    {% comment %}Fall back to main product discount if no variant discount can be found{% endcomment %}
    {% if main_discount_amount != blank and found_variant_discount == false %}
      window.BONFIRE.tag_discounts_override.variant_discounts[{{ variant.id }}] = {variant_id: {{ variant.id | json}}, message: {{ main_discount_message | json}}, amount: {{ main_discount_amount | json}}, code: {{ main_discount_code | json}} };
    {% endif %}
  {% endfor %}
</script>

{% if settings.banner_handle_1 == product.handle %}
  <div class="pdp-banner" style="display:none;background-color:{{ settings.banner_bg_1 }};color:{{ settings.banner_color_1 }};">{{ settings.banner_text_1 | replace: 'line-break', '<br>' }}</div>
{% endif %}
{% if settings.banner_handle_2 == product.handle %}
  <div class="pdp-banner" style="display:none;background-color:{{ settings.banner_bg_2 }};color:{{ settings.banner_color_2 }};">{{ settings.banner_text_2 }}</div>
{% endif %}
{% if settings.banner_handle_3 == product.handle %}
  <div class="pdp-banner" style="display:none;background-color:{{ settings.banner_bg_3 }};color:{{ settings.banner_color_3 }};">{{ settings.banner_text_3 }}</div>
{% endif %}
{% if settings.banner_handle_4 == product.handle %}
  <div class="pdp-banner" style="display:none;background-color:{{ settings.banner_bg_4 }};color:{{ settings.banner_color_4 }};">{{ settings.banner_text_4 }}</div>
{% endif %}
{% if settings.banner_handle_5 == product.handle %}
  <div class="pdp-banner" style="display:none;background-color:{{ settings.banner_bg_5 }};color:{{ settings.banner_color_5 }};">{{ settings.banner_text_5 }}</div>
{% endif %}

<div id="ProductSection-{{ section.id }}" data-section-id="{{ section.id }}" data-section-type="product" data-enable-history-state="true">

    {% assign current_variant = product.selected_or_first_available_variant %}

    {% case section.settings.image_size %}
        {% when 'small' %}
            {%- assign image_size = '640x' -%}
        {% when 'medium' %}
            {%- assign image_size = '820x' -%}
        {% when 'large' %}
            {%- assign image_size = '920x' -%}
    {% endcase %}

    <section class="section section--product-single js-product-single" data-section-id="{{ section.id }}" data-section-type="product-single">

        <div class="product-single product-single--{{ section.settings.layout }} product-single--text-{{ section.settings.text_color }} product-single--{{product.id}} js-product-{{product.id}}">
            <div class="product-single__top">
                
                {% unless section.settings.layout == 'minimal' %}
                    <div class="product-single__top-bg product-single__top-bg--{{ section.settings.bg_height }}{% if section.settings.layout == 'classic' or section.settings.layout == 'minimal' %} js-product-bg js-product-bg--{{ section.settings.bg_height }}{% endif %}" style="background-color: {{ section.settings.bg_color }}"></div>
                {% endunless %}

                {% if section.settings.show_breadcrumbs %}
                    <div class="container container--small">
                        <nav class="breadcrumb breadcrumb--product-single breadcrumb--{{ section.settings.text_color }} u-text-center js-breadcrumb" role="navigation" aria-label="breadcrumbs">
                            <ul class="breadcrumb__items o-list-bare o-list-inline"> 
                                <li class="breadcrumb__item o-list-inline__item">
                                    <a href="{{ routes.root_url }}" title="{{ 'layout.navigation.home' | t }}" class="breadcrumb__link">{{ 'layout.navigation.home' | t }}</a>        
                                </li>
                                {% if collection.url %}
                                    <li class="breadcrumb__item o-list-inline__item">
                                        <a href="{{ collection.url }}" class="breadcrumb__link">{{ collection.title }}</a>
                                    </li>
                                {% endif %}
                                <li class="breadcrumb__item o-list-inline__item">
                                    <span href="{{ routes.root_url }}" class="breadcrumb__link breadcrumb__link--current">{{ product.title | truncate: 35 }}</span>
                                </li>
                            </ul>
                        </nav>
                    </div>
                {% endif %}

                {% if section.settings.layout == 'full' %}
                    <div class="container container--small">
                        <div class="section__title section__title--center{% if section.settings.show_vendor %} section__title--vendor{% endif %} js-product-title">
                            <h1 class="section__title-text product-single__title-text">{{ product.title }}</h1>
                            {% if section.settings.show_vendor %}
                                <h4 class="section__title-desc product-single__title-desc">{{ product.vendor | link_to_vendor }}</h4>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}

      
                <div class="container">
                    {% if section.settings.layout == 'classic' or section.settings.layout == 'minimal' %}
                    <div class="u-hidden@desk-up" data-set="cart-photo-replace">
                        <div class="js-cart-replace">
                    {% endif %}
                            <div class="product-single__photos product-single__photos--{{ section.settings.image_size }}" data-product-media-wrapper data-product-media-group data-enable-video-looping="{{ section.settings.enable_video_looping }}">

                                <div class="product-single__photo js-product-slider" data-slider-id="1">

                                    {% assign zoom_image_count = -1 %}

                                    {% for media in product.media %} 
                                        {% capture img_id %}FeaturedImage-{{ section.id }}-{{ media.id }}{% endcapture %}
                                      
                                        <div class="product-single__photo__wrapper" notab="notab">

                                        {% case media.media_type %}
                                        {% when 'image' %}
                                            <div class="product-single__photo__item product-single__photo__item--image" data-slide-id="{{ forloop.index0 }}" data-media-id="{{ media.id }}">
                                                {%- assign img_url = media | img_url: '1x1' | replace: '_1x1.', '_{width}x.' -%}
                                                <img class="product-single__photo__img js-pswp-img lazyload js"
                                                    src="{{ media | img_url: '300x' }}" 
                                                    data-pswp-src="{{ media | img_url: 'master' }}"
                                                    data-pswp-height="{{ media.height }}"
                                                    data-pswp-width="{{ media.width }}"
                                                    data-src="{{ img_url }}"
                                                    data-media-id="{{ media.id }}"
                                                    data-widths="[180, 360, 540, 720, 900, 1080, 1296, 1512, 1728, 2048]"
                                                    data-sizes="auto"
                                                    data-ratio="{{ media.aspect_ratio }}"
                                                    alt="{{ media.alt | escape }}">
                                                <noscript>
                                                    <img class="product-single__photo__img"
                                                        src="{{ media.src | img_url: '900x' }}"
                                                        alt="{{ media.alt | escape }}">
                                                </noscript>
                                                
                                                {% assign zoom_image_count = zoom_image_count | plus: 1 %}
                                                {% if section.settings.enable_zoom %}
                                                    <div class="product-single__photo__zoom-btn js-pswp-zoom" data-image-count="{{ zoom_image_count }}"></div>
                                                {% endif %}
                                                
                                            </div>

                                        {% when 'video' %}
                                            {%- comment -%}
                                                Load different image sizes depending on the breakpoint for background image overlay
                                            {%- endcomment -%}
                                            {% style %}
                                                @media screen and (max-width: 320px) {
                                                  .product-single__photo__item--{{ media.id }} .plyr__poster {
                                                    background-image: url({{ media.preview_image | img_url: '360x'}}) !important;
                                                  }
                                                }
                                                @media screen and (min-width: 320px) and (max-width: 780px) {
                                                  .product-single__photo__item--{{ media.id }} .plyr__poster {
                                                    background-image: url({{ media.preview_image | img_url: '900x'}}) !important;
                                                  }
                                                }
                                                @media screen and (min-width: 1080px) {
                                                  .product-single__photo__item--{{ media.id }} .plyr__poster {
                                                    background-image: url({{ media.preview_image | img_url: '1080x'}}) !important;
                                                  }
                                                }
                                            {% endstyle %}
                                            <div class="product-single__photo__item product-single__photo__item--video product-single__photo__item--{{ media.id }}" data-slide-id="{{ forloop.index0 }}" data-media-id="{{ media.id }}" style="padding-top: {{ 1 | divided_by: media.aspect_ratio | times: 100 }}%;">
                                                {{ media | video_tag: controls: true, class: 'media-video', image_size: '300x300' }}
                                            </div>

                                        {% when 'external_video' %}
                                            <div class="product-single__photo__item product-single__photo__item--video product-single__photo__item--external-video" data-slide-id="{{ forloop.index0 }}" data-media-id="{{ media.id }}" style="padding-top: {{ 1 | divided_by: media.aspect_ratio | times: 100 }}%;">
                                                {{ media | external_video_tag }}
                                            </div>

                                        {% when 'model' %}
                                            <div class="product-single__photo__item product-single__photo__item--model" data-slide-id="{{ forloop.index0 }}" data-media-id="{{ media.id }}" style="padding-top: 100%">
                                                {{ media | model_viewer_tag: image_size: '800x800', reveal: 'interaction', toggleable: true, data-model-id: media.id}}
                                            </div>                                        
                                        {% else %}
                                            <div class="product-single__photo__item" data-slide-id="{{ forloop.index0 }}" data-media-id="{{ media.id }}" style="padding-top: 100%">
                                                {{ media | media_tag }}
                                            </div>
                                        {% endcase %}
                                        
                                        </div>

                                    {% endfor %}
                                </div>

                                {% assign first_3d_model = product.media | where: "media_type", "model" | first %}
                                {%- if first_3d_model -%}
                                    <button
                                      aria-label="{{ 'products.product.view_in_space_label' | t }}"
                                      class="product-single__view-in-space js-product-view-in-space-btn"
                                      data-shopify-xr
                                      data-shopify-model3d-id="{{ first_3d_model.id }}"
                                      data-shopify-title="{{ product.title }}"
                                      data-shopify-xr-hidden
                                    >
                                        {% include 'icon-3d-badge-full-color' %}<span class='product-single__view-in-space-text'>{{ 'products.product.view_in_space' | t }}</span>
                                    </button>
                                {%- endif -%}

                                {%- if product.media.size > 1 -%}
                                    <div class="product-single__photo__nav js-product-slider-nav">
                                        <div class="product-single__photo__nav__dots js-product-slider-nav-dots"></div>
                                    </div>
                                {%- endif -%}

                                {%- if product.media.size > 1 -%}
                                    <div class="product-single__photo-thumbs js-product-single-thumbs">
                                        {% for media in product.media %}

                                            {%- capture thumbnailAlt -%}
                                                {%- if media.media_type == 'video' or media.media_type == 'external_video' -%}
                                                    {{ 'products.product.video_thumbnail_alt' | t: imageAlt: media.alt | escape }}
                                                {%- elsif media.media_type == 'model' -%}
                                                    {{ 'products.product.model_thumbnail_alt' | t: imageAlt: media.alt | escape }}
                                                {%- else -%}
                                                    {{ 'products.product.gallery_thumbnail_alt' | t: imageAlt: media.alt | escape }}
                                                {%- endif -%}
                                            {%- endcapture -%}

                                            <div>
                                                {%- if media.media_type == 'video' or media.media_type =='external_video' -%}
                                                    <div class="product-single__photo-thumbs__badge product-single__photo-thumbs__badge--video">
                                                        {% include 'icon-video-badge-full-color' %}
                                                    </div>
                                                {%- endif -%}
                                                {%- if media.media_type == 'model' -%}
                                                    <div class="product-single__photo-thumbs__badge product-single__photo-thumbs__badge--model">
                                                        {% include 'icon-3d-badge-full-color' %}
                                                    </div>
                                                {%- endif -%}
                                                <img src="{{ media.preview_image | img_url: '24x24', crop: 'center' }}" data-src="{{ media.preview_image | img_url: '110x110', crop: 'center' }}" alt="{{ thumbnailAlt }}" class="product-single__photo-thumbs__img lazyload" data-media-id="{{ media.id }}">
                                            </div>

                                        {% endfor %}
                                    </div>
                                {%- endif -%}
                            </div>
                    {% if section.settings.layout == 'classic' or section.settings.layout == 'minimal' %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="container container--{{ section.settings.container }}">
                <div class="product-single__bottom">
                    <div class="o-layout o-layout--reverse{% if section.settings.container == 'medium' %} o-layout--large{% endif %}">
                        <div class="o-layout__item u-1/1 u-1/2@desk">

                            {% if section.settings.layout == 'classic' or section.settings.layout == 'minimal' %}
                            <div class="u-hidden@desk-down" data-set="cart-replace">
                                <div class="js-cart-replace">
                            {% endif %}

                                    {% unless section.settings.layout == 'full' %}
                                        <div class="product-single__classic-title">
                                            <div class="section__title{% if section.settings.show_vendor %} section__title--vendor{% endif %} js-product-title">
                                                <h1 class="section__title-text product-single__title-text">{{ product.title }}</h1>
                                                {% if section.settings.show_vendor %}
                                                    <h4 class="section__title-desc product-single__title-desc">{{ product.vendor | link_to_vendor }}</h4>
                                                {% endif %}
                                            </div>
                                        </div>
                                    {% endunless %}

                                    <div class="product-single__box{% unless section.settings.layout == 'minimal' %} js-product-single-box{% endunless %}">
                                      
                                        <div class="product-single__price js-product-price">
                                            <h3 class="product-single__price-text js-product-price-text{% if discounts_enabled %} discounts-enabled{% endif %}">
                                                {% if discounts_enabled %}
                                                  <span class="u-hidden-visually">{{ 'products.general.sale_price' | t }}</span>
                                                  <span class="js-product-price-compare">
                                                      <span class="product-single__price-number product-single__price-compare"><span class="money">{{ current_variant.price | money }}</span></span>
                                                  </span>
                                                  <span class="u-hidden-visually">{{ 'products.general.regular_price' | t }}</span>
                                                  <span class="js-product-price-number">
                                                    {% if variant_discount_initial_amount > main_discount_amount %}
                                                      <span class="product-single__price-number product-single__price-number--sale"><span class="money">{{ current_variant.price | minus: variant_discount_initial_amount | money }}</span></span>
                                                    {% else %}
                                                      <span class="product-single__price-number product-single__price-number--sale"><span class="money">{{ current_variant.price | minus: main_discount_amount | money }}</span></span>
                                                    {% endif %}
                                                  </span>
                                                 {% elsif product_note != "" %}
                                                  <span class="u-hidden-visually">{{ 'products.general.sale_price' | t }}</span>
                                              {% comment %}{% unless product.handle == 'spareveneers' %}
                                                  <span class="js-product-price-compare">
                                                      <s class="product-single__price-compare"><span class="money">{{ current_variant.price | money }}</span></s>
                                                  </span>
                                              {% endunless %}{% endcomment %}
                                                  <span class="u-hidden-visually">{{ 'products.general.regular_price' | t }}</span>
                                                  <span class="product-note">{{ product_note | replace: 'end-accent', '</span>' | replace: 'accent', '<span class="accent-color">' }}</span>
                                                 {% else %}
                                                  {% if product.compare_at_price_max > product.price %}
                                                      <span class="u-hidden-visually">{{ 'products.general.sale_price' | t }}</span>
                                                      <span class="js-product-price-compare">
                                                          <span class="product-single__price-compare"><span class="money">{{ current_variant.compare_at_price | money }}</span></span>
                                                      </span>
                                                  {% endif %}
                                                  <span class="u-hidden-visually">{{ 'products.general.regular_price' | t }}</span>
                                                  <span class="js-product-price-number">
                                                      <span class="product-single__price-number{% if product.compare_at_price_max > product.price %} product-single__price-number--sale{% endif %}"><span class="money">{{ current_variant.price | money }}</span></span>
                                                  </span>
                                                  {% endif %}
                                                  <span class="js-product-price-note"></span>
                                            </h3>

                                            <div class="product-single__price__notes">          
                                                <p class="product-single__price__note product-single__price__note--unit js-price-unit-note">
                                                    {% include 'product-unit-price', variant: current_variant %}
                                                </p>
                                                {% if section.settings.show_tax_notice %}
                                                    <p class="product-single__price__note product-single__price__note--tax">{{ 'products.general.include_taxes_html' | t }}</p>
                                                {% endif %}
                                            </div>
                                        </div>

                                      <style>
                                        .product-single .product-single__price-text.discounts-enabled .product-single__price-compare {
                                          position: relative;
                                        }
                                        .product-single .product-single__price-text.discounts-enabled .product-single__price-compare:after {
                                          display: block;
                                          content: "";
                                          border-bottom: 1px solid #0f4c81;
                                          position: absolute;
                                          top: 50%;
                                          left: 0;
                                          width: 100%;
                                        }
                                      </style>
 

                                        {% capture 'product_id_attr' %}js-product-form--{{ product.id }}{% endcapture %}
                                        {% form 'product', product, data-productid: product.id, class: "product-single__form js-product-form", id:product_id_attr %}

                                            {% assign hide_default_title = false %}
                                            {% if product.variants.size == 1 and product.variants.first.title contains 'Default' %}
                                                {% assign hide_default_title = true %}
                                            {% endif %}

                                            {% if settings.product_reviews %}
                                                <div class="product-single__reviews-stars">
                                                    <a href="#acc-reviews" class="product-single__reviews-stars-link js-accordion-scroll js-accordion-trigger">
                                                        <span class="shopify-product-reviews-badge" data-id="{{ product.id }}"></span>
                                                    </a>
                                                </div>
                                            {% endif %}

                                            <div class="product-single__variant product-single__variant--{{ section.settings.product_variant_style }}">

                                                <select name="id" data-productid="{{ product.id }}" id="productSelect-1" class="product-single__variant-select js-product-variant-select">
                                                    {% for variant in product.variants %}
                                                        {% if variant.available %}
                                                            <option {% if variant == product.selected_or_first_available_variant %} selected="selected" {% endif %} data-sku="{{ variant.sku }}" value="{{ variant.id }}"{% if section.settings.show_inventory %} data-qty="{{ variant.inventory_quantity }}"{% endif %}>{{ variant.title }}</option>
                                                        {% else %}
                                                            <option disabled="disabled">{{ variant.title }} - {{ 'products.product.sold_out' | t }}</option>
                                                        {% endif %}
                                                    {% endfor %}
                                                </select>   
                                                
                                                {% unless hide_default_title %}
                                                    {% if section.settings.product_variant_style == 'buttons' or section.settings.product_variant_style == 'swatches' %}
                                                        <div class="product-single__swatches">
                                                            {% for option in product.options_with_values %}
                                                                {% include 'product-swatch' style: section.settings.product_variant_style %}
                                                            {% endfor %}
                                                        </div>
                                                    {% endif %}
                                                {% endunless %}

                                            </div>

                                            {% if section.settings.show_quantity_selector %}
                                                <div class="product-single__qty">
                                                    <label for="Quantity" class="quantity-selector">{{ 'products.product.quantity' | t }}</label>
                                                    <div class="product-single__qty-input">
                                                        <input type="number" id="Quantity" name="quantity" value="1" min="1" class="quantity-selector">
                                                    </div>
                                                </div>
                                            {% endif %}

                                            {% if section.settings.show_inventory %}
                                                <p class="product-single__stock-note js-price-stock-note" data-qty-limit="{{ section.settings.inventory_limit }}" {% if current_variant.inventory_management == "shopify" and current_variant.available %}{% unless current_variant.inventory_quantity <= section.settings.inventory_limit %} style="display:none;"{% endunless %}{% endif %}>{{ 'products.product.qty_notice_html' | t: count: current_variant.inventory_quantity }}</p>
                                            {% endif %}

                                            <div class="product-single__add js-product-buttons{% unless product.available %} product-single__add--sold{% endunless %}">

                                                <button id="primary-atc-btn" type="submit" name="add" class="c-btn c-btn--full c-btn--plus c-btn--{% if section.settings.enable_payment_button %}light{% else %}primary{% endif %} product-single__add-btn js-product-add">
                                                    <span class="js-product-add-text">{{ 'products.product.add_to_cart' | t }}</span>
                                                </button>
                                                {% if section.settings.enable_payment_button %}
                                                    {{ form | payment_button }}
                                                {% endif %}

                                            </div>

                                      <div class="pdp-trust-badges">
                                        {% if trust_icon_1 != "" %}
                                          <span class="trust-badge"><img src="{{ trust_icon_1 }}"></span>
                                        {% endif %}
                                        {% if trust_icon_2 != "" %}
                                          <span class="trust-badge"><img src="{{ trust_icon_2 }}"></span>
                                        {% endif %}
                                        {% if trust_icon_3 != "" %}
                                          <span class="trust-badge"><img src="{{ trust_icon_3 }}"></span>
                                        {% endif %}
                                        {% if trust_icon_4 != "" %}
                                          <span class="trust-badge"><img src="{{ trust_icon_4 }}"></span>
                                        {% endif %}
                                        {% if trust_icon_5 != "" %}
                                          <span class="trust-badge"><img src="{{ trust_icon_5 }}"></span>
                                        {% endif %}
                                        {% if trust_icon_6 != "" %}
                                          <span class="trust-badge"><img src="{{ trust_icon_6 }}"></span>
                                        {% endif %}
                                        {% if trust_icon_7 != "" %}
                                          <span class="trust-badge"><img src="{{ trust_icon_7 }}"></span>
                                        {% endif %}
                                      </div>
                            {% unless product.handle == 'spareveneers' %}
                                      <div class="pdp-payment-options" style="background:#d8dbe9; padding:25px;">
                                        <h6><strong>Payment Plan Options</strong><br><span class="js-product-price-note"></span></h6>
                                        <p class="affirm-as-low-as" data-page-type="product" data-amount="{{current_variant.price}}"></p>
                                        <div class="afterpayPlacement"></div>
                                        <div class="partially-placement"><img src="https://cdn.shopify.com/s/files/1/0382/1761/3450/files/partially-logo.png?v=1675220469"><span>16 week plans as low as <strong>$29</strong>/week (no discount codes)</span></div>
                                        {% comment %}<quadpay-widget-v3 amount="{{ current_variant.price }}" merchantId="a8cb308a-4a5f-4876-9ba3-3ae49702f16d" ></quadpay-widget-v3>{% endcomment %}	
                                        <div class="zip-payments"><span>4 interest-free payments on orders up to <strong>$1500</strong> with</span><img src="{{ 'zip-logo.png' | asset_url }}"></div>                                        
                                        {% comment %}<div id="klarna-placement"></div>{% endcomment %}
                                        <klarna-placement 
                                          id="klarna-widget" 
                                          data-purchase-amount="{{ current_variant.price }}"                                        
                                          data-key="credit-promotion-badge"
                                          data-preloaded="true"
                                          data-locale="en-US">
                                        </klarna-placement>
                                        {% comment %}<afterpay-placement
                                          data-amount="{{ current_variant.price }}"
                                          data-locale="en_US"
                                          data-currency="USD"
                                          data-show-lower-limit="false">
                                        </afterpay-placement>{% endcomment %}
                                      </div>
                          {% endunless %}              
                                        {% endform %}
                             
                                        {% if section.settings.image != blank %}
                                            <div class="product-single__img">
                                                {%- assign img_url = section.settings.image | img_url: '1x1' | replace: '_1x1.', '_{width}x.' -%}
                                                <img class="product-single__img__img lazyload js"
                                                    src="{{ section.settings.image | img_url: '300x' }}" 
                                                    data-src="{{ img_url }}"
                                                    data-widths="[180, 360, 540, 720, 900]"
                                                    data-sizes="auto"
                                                    alt="{{ section.settings.image.alt }}">
                                                <noscript>
                                                    <img class="product-single__img__img"
                                                        src="{{ section.settings.image | img_url: '720x' }}"
                                                        alt="{{ section.settings.image.alt }}">
                                                </noscript>
                                            </div>
                                        {% endif %}

                                        {% if section.settings.show_share_buttons %}
                                            {% capture share_link %}{{ shop.url }}{{ product.url }}{% endcapture %}
                                            {% capture share_title %}{{ product.title | url_param_escape }}{% endcapture %}
                                            {% capture share_img %}{{ product.featured_image | product_img_url: '1024x1024' }}{% endcapture %}
                                            <div class="product-single__share">
                                                <ul class="product-single__share-items o-list-bare">
                                                    {% if settings.share_facebook %}
                                                    <li class="product-single__share-item">
                                                        <a href="//www.facebook.com/sharer.php?u={{ share_link }}" class="product-single__share-link icon-fallback" target="_blank">
                                                            <i class="icon icon--facebook" aria-hidden="true"></i>
                                                            <span class="icon-fallback__text">Facebook</span>
                                                        </a>
                                                    </li>
                                                    {% endif %}
                                                    {% if settings.share_twitter %}
                                                    <li class="product-single__share-item">
                                                        <a href="//twitter.com/share?text={{ share_title }}&amp;url={{ share_link }}" class="product-single__share-link icon-fallback" target="_blank">
                                                            <i class="icon icon--twitter" aria-hidden="true"></i>
                                                            <span class="icon-fallback__text">Twitter</span>
                                                        </a>
                                                    </li>
                                                    {% endif %}
                                                    {% if settings.share_pinterest %}
                                                    <li class="product-single__share-item">
                                                        <a href="http://pinterest.com/pin/create/button/?url={{ share_link }}&amp;media={{ share_img }}&amp;description={{ share_title }}" class="product-single__share-link icon-fallback" target="_blank">
                                                            <i class="icon icon--pinterest" aria-hidden="true"></i>
                                                            <span class="icon-fallback__text">Pinterest</span>
                                                        </a>
                                                    </li>
                                                    {% endif %}
                                                    {% if settings.share_fancy %}
                                                    <li class="product-single__share-item">
                                                        <a href="//www.thefancy.com/fancyit?ItemURL={{ share_link }}&Title={{ share_title }}&ImageURL={{ share_img }}" class="product-single__share-link icon-fallback" target="_blank">
                                                            <i class="icon icon--fancy" aria-hidden="true"></i>
                                                            <span class="icon-fallback__text">Fancy</span>
                                                        </a>
                                                    </li>
                                                    {% endif %}
                                                    {% if settings.share_mail %}
                                                    <li class="product-single__share-item">
                                                        <a href="mailto:?body={{ share_title }} - {{ share_link }}" class="product-single__share-link icon-fallback">
                                                            <i class="icon icon--mail" aria-hidden="true"></i>
                                                            <span class="icon-fallback__text">Email</span>
                                                        </a>
                                                    </li>
                                                    {% endif %}
                                                </ul>
                                            </div>
                                        {% endif %}
                                    </div>

                                    {% if section.settings.layout == 'minimal' %}
                                        <div class="product-single__content-text rte">
                                            {{ product.description }}
                                        </div>
                                    {% endif %}

                            {% if section.settings.layout == 'classic' or section.settings.layout == 'minimal' %}
                                </div>
                            </div>
                            {% endif %}

                        </div>
                        <div class="o-layout__item u-1/1 u-1/2@desk">
                            
                            {% if section.settings.layout == 'classic' or section.settings.layout == 'minimal' %}
                                <div class="u-hidden@desk-down" data-set="cart-photo-replace"></div>
                                <div class="u-hidden@desk-up" data-set="cart-replace"></div>
                            {% endif %}
                            
                            <div class="product-single__content">
                                
                                {% unless section.settings.layout == 'minimal' %}
                                    <div class="product-single__content-text rte">
                                        {{ product.description }}
                                    </div>
                                {% endunless %}

                                <div class="product-single__accordion js-accordion">

                                    {% for block in section.blocks %}
                                        {%- assign tab = pages[block.settings.tab_content] -%}
                                        {% unless tab.title == blank %}
                                            <a href="#acc-{{ forloop.index }}" class="product-single__accordion__title js-accordion-trigger">
                                                <h4 class="product-single__accordion__title-text">{{ tab.title }}</h4>
                                                <span class="product-single__accordion__title-icon icon-fallback">
                                                    <i class="icon icon--plus" aria-hidden="true"></i>
                                                    <span class="icon-fallback__text">{{ 'products.layout.tab_label' | t }}</span>
                                                </span>
                                            </a>
                                            <div id="acc-{{ forloop.index }}" class="product-single__accordion__item js-accordion-info">
                                                <div class="product-single__accordion__item-wrap rte">
                                                    {{ tab.content }}
                                                </div>
                                            </div>
                                        {% endunless %}
                                    {% endfor %}

                                    {% if settings.product_reviews %}
                                        <a href="#acc-reviews" class="product-single__accordion__title js-accordion-trigger js-review-accordion">
                                            <h4 class="product-single__accordion__title-text">{{ 'products.layout.reviews' | t }}</h4>
                                            <span class="product-single__accordion__title-icon icon-fallback">
                                                <i class="icon icon--plus" aria-hidden="true"></i>
                                                <span class="icon-fallback__text">{{ 'products.layout.tab_label' | t }}</span>
                                            </span>
                                        </a>
                                        <div id="acc-reviews" class="product-single__accordion__item js-accordion-info">
                                            <div class="product-single__accordion__item-wrap rte">
                                                <div class="product-single__reviews">
                                                    <div id="shopify-product-reviews" data-id="{{product.id}}">{{ product.metafields.spr.reviews }}</div>
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}
                                    
                                </div>

                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>
</div>
<!-- sticky cart on product page -->
{% if product.handle contains 'top-bottom-teeth' %}
  {% include 'mobile-atc-modal' %}
{% endif %}

{% unless product == empty %}
    <script type="application/json" id="ModelJson-{{ section.id }}">
        {{ product.media | where: 'media_type', 'model' | json }}
    </script>
{% endunless %}

{% schema %}
{
    "name": "Product page",
    "class": "js-section__product-single",
    "max_blocks": 5,
    "settings": [
        {
            "type": "select",
            "id": "layout",
            "label": "Layout",
            "options": [
                {
                    "value": "full",
                    "label": "Full width"
                },
                {
                    "value": "classic",
                    "label": "Classic"
                },
                {
                    "value": "minimal",
                    "label": "Clean"
                }
            ],
            "default": "classic"
        },
        {
            "type": "select",
            "id": "container",
            "label": "Layout width",
            "default": "medium",
            "options": [
                {
                    "label": "Default",
                    "value": "medium"
                },
                {
                    "label": "Narrow",
                    "value": "small"
                },
                {
                    "label": "Wide",
                    "value": "full"
                }
            ]
        },
        {
            "type": "checkbox",
            "id": "show_breadcrumbs",
            "label": "Show breadcrumbs",
            "default": false
        },
        {
            "type": "checkbox",
            "id": "show_vendor",
            "label": "Show vendor",
            "default": false
        },
        {
            "type": "select",
            "id": "product_variant_style",
            "label": "Product variant style",
            "options": [
                {
                    "value": "dropdowns",
                    "label": "Dropdowns"
                },
                {
                    "value": "buttons",
                    "label": "Buttons"
                },
                {
                    "value": "swatches",
                    "label": "Color swatches and buttons"
                }
            ],
            "default": "buttons"
        }, 
        {
            "type": "checkbox",
            "id": "use_swatch_images",
            "label": "Show custom swatch images",
            "default": false,
            "info": "Learn more how to setup custom swatch colors and images [here](https://support.safeasmilk.co/article/111-product-page-dispaly-color-swatches)."
        },
        {
            "type": "checkbox",
            "id": "show_quantity_selector",
            "label": "Show quantity selector",
            "default": false
        },
        {
            "type": "checkbox",
            "id": "show_tax_notice",
            "label": "Show tax notice",
            "default": false
        },
        {
            "type": "checkbox",
            "id": "show_inventory",
            "label": "Show low stock notice",
            "default": true
        },
        {
            "type": "range",
            "id": "inventory_limit",
            "label": "Low stock notice threshold",
            "min": 1,
            "max": 30,
            "step": 1,
            "default": 3,
            "info": "Notice will show if quantity is equal or lower than the threshold."
        },
        {
            "type": "checkbox",
            "id": "enable_payment_button",
            "label": "Show dynamic checkout button",
            "info": "Lets customers check out directly using a familiar payment method. [Learn more](https://help.shopify.com/manual/using-themes/change-the-layout/dynamic-checkout)",
            "default": true
        },
        {
            "type": "image_picker",
            "id": "image",
            "label": "Checkout badges image"
        },
        {
            "type": "checkbox",
            "id": "show_share_buttons",
            "label": "Show social sharing buttons",
            "default": true
        },
        {
            "type": "header",
            "content": "Media",
            "info": "Learn more about [media types](https://help.shopify.com/manual/products/product-media)"
        },
        {
            "type": "checkbox",
            "id": "enable_zoom",
            "label": "Enable image zoom",
            "default": true
        },
        {
            "type": "checkbox",
            "id": "enable_video_looping",
            "label": "Enable video looping",
            "default": false
        },
        {
            "type": "select",
            "id": "image_size",
            "label": "Image size",
            "options": [
                {
                    "value": "small",
                    "label": "Small"
                },
                {
                    "value": "medium",
                    "label": "Medium"
                },
                {
                    "value": "large",
                    "label": "Large"
                }
            ],
            "default": "large"
        },
        {
            "type": "color",
            "id": "bg_color",
            "label": "Background color",
            "default": "#ffffff",
            "info": "Only works with Full width and Classic layouts."
        },
        {
            "type": "select",
            "id": "text_color",
            "label": "Text color",
            "options": [
                {
                    "value": "default",
                    "label": "Default"
                },
                {
                    "value": "default-light",
                    "label": "Default light"
                },
                {
                    "value": "dark",
                    "label": "Dark"
                },
                {
                    "value": "light",
                    "label": "Light"
                }
            ],
            "default": "default"
        },
        {
            "type": "select",
            "id": "bg_height",
            "label": "Background height",
            "options": [
                {
                    "value": "default",
                    "label": "Default"
                },
                {
                    "value": "full",
                    "label": "Full"
                }
            ],
            "default": "default"
        }
    ],
    "blocks": [
        {
            "type": "text",
            "name": "Content tab",
            "settings": [
                {
                    "type": "page",
                    "id": "tab_content",
                    "label": "Tab content",
                    "info": "Select page that will populate tab with content."
                }
            ]
        }
    ]
}
{% endschema %}

{% if product.metafields.loox.num_reviews %}
<script id="looxSchemaJson" type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "Product",
	"@id": {{ canonical_url | json }},
	"aggregateRating": {
		"@type": "AggregateRating",
		"ratingValue": "{{ product.metafields.loox.avg_rating }}",
		"reviewCount": "{{ product.metafields.loox.num_reviews }}"
	},
	"name": {{ product.title | json }}
}
</script>
{% endif %}


	<div id="looxReviews" data-product-id="{{product.id}}" class="loox-reviews-default">{{ product.metafields.loox.reviews }}</div>
<div class="zrx-product-bottom"></div>
